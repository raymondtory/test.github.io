<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!--reset-->
    <link rel="stylesheet" href="styles/layout/reset.css">
    <!--font-awesome-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!--indexCSS-->
    <link rel="stylesheet" href="styles/admin/globalStyle.css">
    <link rel="stylesheet" href="styles/admin/headerStyle.css">
    <link rel="stylesheet" href="styles/admin/memberManagement/mianStyle.css">
    <link rel="stylesheet" href="styles/admin/memberManagement/modalStyle.css">
    <style>
        
    </style>
</head>
<body>
    <div class="wrapper">

        <header>
            <a href="#">
                <img class="imgLogo" src="./images/Logo.jpg" alt="無法顯示圖片">
            </a>

            <ul class="topNav" id="topNav">
                <li><a href="#">商品管理</a></li>|
                <li><a href="#">會員管理</a></li>|
                <li><a href="#">新增管理員</a></li>|
                <li><a href="#"><i class="fa-solid fa-user-large"></i></a></li>

            </ul>
            <div class="memberContainer" id="memberContainer">
                <ul class="memberNav">

                    <a href="#">
                        <li>修改個人資料</li>
                    </a>
                    <a href="#">
                        <li>登出</li>
                    </a>

                </ul>
            </div>
        </header>

        <div class="main">
            <div class="pageTitleContainer"><h1 class="pageTitle">首頁管理</h1></div>
            
            <table class="pageTable">
                <thead> 
                    <tr>
                        <th>會員編號</th>
                        <th>會員名稱</th>
                        <th>會員密碼</th>
                        <th>會員電話</th>
                        <th>會員信箱</th>
                        <th>會員性別</th>
                        <th>會員地址</th>
                        <th>修改</th>
                        <th>刪除</th>
                    </tr>                
                </thead>
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>QQQ</td>
                        <td>NT$68</td>
                        <td>NT$68</td>
                        <td>NT$68</td>
                        <td>NT$68</td>
                        <td>NT$68</td>
                        <td><button class="edit" id="edit"><i class="fa-solid fa-pen-to-square"></i></button></td>
                        <td><button class="delete"><i class="fa-solid fa-trash-can"></i></button></td>
                    </tr>
                    
                </tbody>
            </table>
        </div>
        <div class="modalContainer" id="modalContainer">
            <div>
                <div class="modalTitle">
                    <div class="close" id="close"><i class="fa-solid fa-square-xmark" ></i></div>
                </div>
                <div class="modal">
                    <form action="" id="modalForm">
                        
                        <input type="hidden" id="memberId" name="userId">
                        <div class="createProductContainer">
        
                            
                                <p>-基本資料- <span style="color:red">(必填)</span></p>
                                <div class="inputItem">
                                    <label for="userName">用戶名稱</label>
                                    <div>
                                        <input type="text" id="userName" name="userName" data-val="true" data-val-required="不可為空" data-val-length="長度不可超過 20。" maxlength="25">
                                        <div style="color: red;" data-valmsg-for="userName" data-valmsg-replace="true" ></div>
                                    </div>
                                    
                                </div>
                                

                                <div class="inputItem">
                                    <label for="userPassword">用戶密碼</label>
                                    <div>
                                        <input type="text" id="userPassword" name="userPassword" data-val="true" data-val-required="不可為空">
                                        <div style="color: red;" data-valmsg-for="userPassword" data-valmsg-replace="true"></div>
                                    </div>
                                </div>
                                <div class="inputItem">
                                    <label for="userEmail">聯絡電話</label>
                                    <div>
                                        <input type="text" id="userPhone" name="userPhone" data-val="true" data-val-required="不可為空" data-val-phone="電話格式不符">
                                        <div style="color: red;" data-valmsg-for="userPhone" data-valmsg-replace="true"></div>
                                    </div>
                                </div>
                                <div class="inputItem">
                                    <label for="userEmail">信箱</label>
                                    <div>
                                        <input type="text" id="userEmail" name="userEmail" data-val="true" data-val-required="不可為空"  data-val-email="信箱格式不符">
                                        <div style="color: red;" data-valmsg-for="userEmail" data-valmsg-replace="true"></div>
                                    </div>
                                </div>
                                <div class="inputItem radioInputContainer">
                                    <label for="userEmail">性別</label>
                                    <div>
                                        <input type="radio" name="userGender" id="M">
                                        <label for="M">男</label>
                                        <input type="radio" name="userGender" id="F">
                                        <label for="F">女</label>
                                    </div>
                                    
                                </div>
                                <div class="inputItem">
                                    <label for="userAddress">地址</label>
                                    <input type="text" id="userAddress" name="userAddress">
                                </div>
        

                        </div>
        
                        <div class="inputItem buttonInputItem">
                            <input type="button" value="建立" id="createProductButton">
                            <input type="button" value="修改" id="editProductButton">
                            
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!--JQuery-->
    <!-- <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.11/jquery.validate.unobtrusive.min.js"></script>
    <script src="scripts/layout/showMemberContainer.js"></script> 
    <script>
        
        $("#createUserButton").css("display","none")
        $("#editUserButton").css("display","none")
        
        //reloadPageTable
        async function reloadPageTable(url='https://localhost:7008/User/loadUsers'){
            let tbody = $("#pageTable")
            tbody.empty();
            const response = await fetch(url)
            const data = await response.json();
            for(let i = 0 ;i<data.length;i++){
                let tr = $("<tr/>")
                let userId = $("<td/>").html(`${data[i].userId}`);
                let userName = $("<td/>").html(`${data[i].userName}`);
                let userPassword = $("<td/>").html(`${data[i].userPassword}`);
                let userPhone = $("<td/>").html(`${data[i].userPhone}`);
                let userEmail = $("<td/>").html(`${data[i].userEmail}`);
                let userGender = $("<td/>").html(`${data[i].userGender}`);
                let userAddress = $("<td/>").html(`${data[i].userAddress}`);
                let editBtn = $("<td/>").html(`<button class="edit" id="edit"><i class="fa-solid fa-pen-to-square"></i></button>`);
                let deleteBtn = $("<td/>").html(`<button class="delete"><i class="fa-solid fa-trash-can"></i></button>`);
                tr.append([userId,userName,userPassword,userPhone,userEmail,userGender,userAddress,editBtn,deleteBtn])
                tbody.append(tr);
            }
            
        }
        //關閉modal
        $("#close").on("click",()=>{
            $("#modalContainer").css("display","none")
            $("#createUserButton").css("display","none")
            $("#editUserButton").css("display","none")
            $("#modalForm").trigger("reset")
        })
        //進入新增
        $("#create").on("click",()=>{
            $("#modalContainer").css("display","block")
            $("#createUserButton").css("display","block")

        })
        //送出新增
        $("#createUserButton").on("click",async function(){
            const formData = new FormData(document.forms["modalForm"])
            const response = await fetch("https://localhost:7008/User/create",{
                method:'post',
                body:formData
            })
            const data= await response.text();

            alert(data);
            $("#close").trigger("click")
            reloadPageTable();
        })
        //進入編輯
        $(".edit").on("click",function(){
            $("#modalContainer").css("display","block")
            $("#editUserButton").css("display","block")
            let row = $(this).parents("tr")
            let userId = row.find("td").eq(0).html();
            let userName = row.find("td").eq(1).html();
            let userPassword = row.find("td").eq(2).html();
            let userPhone = row.find("td").eq(3).html();
            let userEmail = row.find("td").eq(4).html();
            let userGender = row.find("td").eq(5).html();
            let userAddress = row.find("td").eq(6).html();
            
            $("#userId").val(userId)
            $("#userName").val(userName)
            $("#userPassword").val(userPassword)
            $("#userPhone").val(userPhone)
            $("#userEmail").val(userEmail)
            $(".radioInputContainer").find(`input[value='${userGender}']`).prop("checked",true)
            $("#userAddress").val(userAddress)

        })
        //送出編輯
        $("#editUserButton").on("click",async function(){
            const formData = new FormData(document.forms["modalForm"])
            const response = await fetch("https://localhost:7008/User/edit",{
                method:'post',
                body:formData
            })
            const data = await response.text();
            alert(data);
            $("#close").trigger("click")
            reloadPageTable();
        })
        //驗證
        $("#userName").on("blur keyup",function(){
            $("#modalForm").validate().element(this)

        })
        $("#userPassword").on("blur keyup",function(){
            $("#modalForm").validate().element(this)

        })
        $("#userPhone").on("blur keyup",function(){
            $("#modalForm").validate().element(this)

        })
        $("#userEmail").on("blur keyup",function(){
            $("#modalForm").validate().element(this)

        })
        //送出刪除
        $(".delete").on("click",async function(){
            let row = $(this).parents("tr")
            let userId = row.find("td").eq(0).html();

            const response = await fetch("https://localhost:7008/User/delete?id=" + `${userId}`)
            const data = await response.text();
            alert(data);
            reloadPageTable();
        })

        //search 
        $("#searchBtn").on("click",async function(){
            let keyword = $("#searchInput").val();
            //const response = await fetch("https://localhost:7008/User/searchUser?keyword=" + `${keyword}`)
            //const data = await response.json;

            reloadPageTable("https://localhost:7008/User/searchUser?keyword=" + `${keyword}`)

        })
        $("#searchBarInput").on("keyup",function(e){
            if(e.keyCode == 13 ){
                $("#searchBtn").trigger("click")
            }
        })
        

        
    </script>
</body>
</html>